var AjaxRequest={themePath:Contao.script_url+"system/themes/"+Contao.theme+"/",toggleNavigation:function(e,t,n){e.blur();var a=$(t),o=$(e).getParent("li");return!!a&&(o.hasClass("collapsed")?(o.removeClass("collapsed"),$(e).setAttribute("title",Contao.lang.collapse),new Request.Contao({url:n}).post({action:"toggleNavigation",id:t,state:1,REQUEST_TOKEN:Contao.request_token})):(o.addClass("collapsed"),$(e).setAttribute("title",Contao.lang.expand),new Request.Contao({url:n}).post({action:"toggleNavigation",id:t,state:0,REQUEST_TOKEN:Contao.request_token})),!1)},toggleStructure:function(e,t,n,a){e.blur();var o=$(t),l=$(e).getFirst("img");return o?("none"==o.getStyle("display")?(o.setStyle("display",null),l.src=AjaxRequest.themePath+"icons/folMinus.svg",$(e).setAttribute("title",Contao.lang.collapse),new Request.Contao({field:e}).post({action:"toggleStructure",id:t,state:1,REQUEST_TOKEN:Contao.request_token})):(o.setStyle("display","none"),l.src=AjaxRequest.themePath+"icons/folPlus.svg",$(e).setAttribute("title",Contao.lang.expand),new Request.Contao({field:e}).post({action:"toggleStructure",id:t,state:0,REQUEST_TOKEN:Contao.request_token})),!1):(new Request.Contao({field:e,evalScripts:!0,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(o){var i=new Element("li",{id:t,class:"parent",styles:{display:"inline"}});if(new Element("ul",{class:"level_"+n,html:o}).inject(i,"bottom"),5==a)i.inject($(e).getParent("li"),"after");else{for(var r,c=!1,s=$(e).getParent("li");"element"==typeOf(s)&&(r=s.getNext("li"));)if((s=r).hasClass("tl_folder")){c=!0;break}c?i.inject(s,"before"):i.inject(s,"after")}i.getElements("a").each((function(e){e.href=e.href.replace(/&ref=[a-f0-9]+/,"&ref="+Contao.referer_id)})),$(e).setAttribute("title",Contao.lang.collapse),l.src=AjaxRequest.themePath+"icons/folMinus.svg",window.fireEvent("structure"),AjaxRequest.hideBox(),window.fireEvent("ajax_change")}}).post({action:"loadStructure",id:t,level:n,state:1,REQUEST_TOKEN:Contao.request_token}),!1)},toggleFileManager:function(e,t,n,a){e.blur();var o=$(t),l=$(e).getFirst("img");return o?("none"==o.getStyle("display")?(o.setStyle("display",null),l.src=AjaxRequest.themePath+"icons/folMinus.svg",$(e).setAttribute("title",Contao.lang.collapse),new Request.Contao({field:e}).post({action:"toggleFileManager",id:t,state:1,REQUEST_TOKEN:Contao.request_token})):(o.setStyle("display","none"),l.src=AjaxRequest.themePath+"icons/folPlus.svg",$(e).setAttribute("title",Contao.lang.expand),new Request.Contao({field:e}).post({action:"toggleFileManager",id:t,state:0,REQUEST_TOKEN:Contao.request_token})),!1):(new Request.Contao({field:e,evalScripts:!0,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(n){var o=new Element("li",{id:t,class:"parent",styles:{display:"inline"}});new Element("ul",{class:"level_"+a,html:n}).inject(o,"bottom"),o.inject($(e).getParent("li"),"after"),o.getElements("a").each((function(e){e.href=e.href.replace(/&ref=[a-f0-9]+/,"&ref="+Contao.referer_id)})),$(e).setAttribute("title",Contao.lang.collapse),l.src=AjaxRequest.themePath+"icons/folMinus.svg",AjaxRequest.hideBox(),window.fireEvent("ajax_change")}}).post({action:"loadFileManager",id:t,level:a,folder:n,state:1,REQUEST_TOKEN:Contao.request_token}),!1)},toggleSubpalette:function(e,t,n){e.blur();var a=$(t);function o(t){e.form.elements.VERSION_NUMBER&&(e.form.elements.VERSION_NUMBER.value=/<input\s+[^>]*?name="VERSION_NUMBER"\s+[^>]*?value="([^"]*)"/i.exec(t)[1])}a?e.value?(e.value="",e.checked="",a.setStyle("display","none"),a.getElements("[required]").each((function(e){e.set("required",null).set("data-required","")})),new Request.Contao({field:e,onSuccess:o}).post({action:"toggleSubpalette",id:t,field:n,state:0,REQUEST_TOKEN:Contao.request_token})):(e.value=1,e.checked="checked",a.setStyle("display",null),a.getElements("[data-required]").each((function(e){e.set("required","").set("data-required",null)})),new Request.Contao({field:e,onSuccess:o}).post({action:"toggleSubpalette",id:t,field:n,state:1,REQUEST_TOKEN:Contao.request_token})):new Request.Contao({field:e,evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(n,a){var l=new Element("div",{id:t,class:"subpal cf",html:n,styles:{display:"block"}}).inject($(e).getParent("div").getParent("div"),"after");a.javascript&&(document.write=function(e){var t="";e.replace(/<script src="([^"]+)"/i,(function(e,n){t=n})),t&&Asset.javascript(t,{onLoad:function(){Browser.exec(a.javascript)}})},Browser.exec(a.javascript)),e.value=1,e.checked="checked",l.getElements("a").each((function(e){e.href=e.href.replace(/&ref=[a-f0-9]+/,"&ref="+Contao.referer_id)})),o(n),AjaxRequest.hideBox(),window.fireEvent("ajax_change")}}).post({action:"toggleSubpalette",id:t,field:n,load:1,state:1,REQUEST_TOKEN:Contao.request_token})},toggleField:function(e,t){e.blur();var n,a,o=null,l=$(e).getFirst("img"),i=1==l.get("data-state"),r=e.getParent("div");return t&&(r.hasClass("tl_right")?o=r.getPrevious("div").getElement("img"):r.hasClass("tl_listing_container")?(null===(o=e.getParent("td").getPrevious("td").getFirst("div.list_icon"))&&(o=e.getParent("td").getPrevious("td").getElement("div.cte_type")),null===o&&(o=e.getParent("tr").getFirst("td").getElement("div.list_icon_new"))):(n=r.getNext("div"))&&(n.hasClass("cte_type")&&(o=n),null===o&&(o=n.getFirst("div.list_icon"))),null!==o&&("img"==o.nodeName.toLowerCase()?(o.getParent("ul.tl_listing").hasClass("tl_tree_xtnd")||(a=o.getParent("a"))&&-1==a.href.indexOf("contao/preview")&&(o=(n=a.getNext("a"))?n.getFirst("img"):new Element("img")),o.src=i?o.get("data-icon-disabled"):o.get("data-icon")):o.hasClass("cte_type")?i?(o.addClass("unpublished"),o.removeClass("published")):(o.addClass("published"),o.removeClass("unpublished")):o.setStyle("background-image","url("+(i?o.get("data-icon-disabled"):o.get("data-icon"))+")"))),l.src=i?l.get("data-icon-disabled"):l.get("data-icon"),l.set("data-state",i?0:1),new Request.Contao({url:e.href,followRedirects:!1}).get(),!1},toggleFieldset:function(e,t,n){e.blur(),Backend.getScrollOffset();var a=$("pal_"+t);if(a.hasClass("collapsed"))a.removeClass("collapsed"),(new Request.Contao).post({action:"toggleFieldset",id:t,table:n,state:1,REQUEST_TOKEN:Contao.request_token});else{for(var o=a.getParent("form"),l=a.getElements("[required]"),i=!0,r=0;r<l.length;r++)if(!l[r].get("value")){i=!1;break}i?(a.addClass("collapsed"),(new Request.Contao).post({action:"toggleFieldset",id:t,table:n,state:0,REQUEST_TOKEN:Contao.request_token})):"function"==typeof o.checkValidity&&o.getElement('button[type="submit"]').click()}return!1},toggleCheckboxGroup:function(e,t){e.blur();var n=$(t),a=$(e).getFirst("img");return!!n&&("none"==n.getStyle("display")?(n.setStyle("display",null),a.src=AjaxRequest.themePath+"icons/folMinus.svg",(new Request.Contao).post({action:"toggleCheckboxGroup",id:t,state:1,REQUEST_TOKEN:Contao.request_token})):(n.setStyle("display","none"),a.src=AjaxRequest.themePath+"icons/folPlus.svg",(new Request.Contao).post({action:"toggleCheckboxGroup",id:t,state:0,REQUEST_TOKEN:Contao.request_token})),!0)},displayBox:function(e){var t=$("tl_ajaxBox"),n=$("tl_ajaxOverlay"),a=window.getScroll();null===n&&(n=new Element("div",{id:"tl_ajaxOverlay"}).inject($(document.body),"bottom")),n.set({styles:{display:"block",top:a.y+"px"}}),null===t&&(t=new Element("div",{id:"tl_ajaxBox"}).inject($(document.body),"bottom")),t.set({html:e,styles:{display:"block",top:a.y+100+"px"}})},hideBox:function(){var e=$("tl_ajaxBox"),t=$("tl_ajaxOverlay");t&&t.setStyle("display","none"),e&&e.setStyle("display","none")}},Backend={currentId:null,popupWindow:null,themePath:Contao.script_url+"system/themes/"+Contao.theme+"/",openModalWindow:function(e,t,n){new SimpleModal({width:e,hideFooter:!0,draggable:!1,overlayOpacity:.7,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}}).show({title:t,contents:n})},openModalImage:function(e){var t=e||{},n=(window.getSize().x-20).toInt();(!t.width||t.width>n)&&(t.width=Math.min(n,900)),new SimpleModal({width:t.width,hideFooter:!0,draggable:!1,overlayOpacity:.7,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}}).show({title:t.title,contents:'<img src="'+t.url+'" alt="">'})},openModalIframe:function(e){var t=e||{},n=(window.getSize().x-20).toInt(),a=(window.getSize().y-137).toInt();(!t.width||t.width>n)&&(t.width=Math.min(n,900)),(!t.height||t.height>a)&&(t.height=a),new SimpleModal({width:t.width,hideFooter:!0,draggable:!1,overlayOpacity:.7,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}}).show({title:t.title,contents:'<iframe src="'+t.url+'" width="100%" height="'+t.height+'" frameborder="0"></iframe>',model:"modal"})},openModalSelector:function(e){var t=e||{},n=(window.getSize().x-20).toInt(),a=(window.getSize().y-192).toInt();t.id||(t.id="tl_select"),(!t.width||t.width>n)&&(t.width=Math.min(n,900)),(!t.height||t.height>a)&&(t.height=a);var o=new SimpleModal({width:t.width,draggable:!1,overlayOpacity:.7,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});o.addButton(Contao.lang.cancel,"btn",(function(){this.buttons[0].hasClass("btn-disabled")||this.hide()})),o.addButton(Contao.lang.apply,"btn primary",(function(){if(!this.buttons[1].hasClass("btn-disabled")){var e,n,a,o,l,i=window.frames["simple-modal-iframe"],r=[];if(void 0!==i){for((o=(e=i.document.getElementById(t.id)).get("data-picker-value"))&&(r=JSON.parse(o)),n=e.getElementsByTagName("input"),a=0;a<n.length;a++)n[a].id.match(/^(check_all_|reset_)/)||(l=r.indexOf(n[a].get("value")),n[a].checked?-1==l&&r.push(n[a].get("value")):-1!=l&&r.splice(l,1));t.callback(e.get("data-table"),r),this.hide()}else alert("Could not find the SimpleModal frame")}})),o.show({title:t.title,contents:'<iframe src="'+t.url+'" name="simple-modal-iframe" width="100%" height="'+t.height+'" frameborder="0"></iframe>',model:"modal"})},openModalBrowser:function(e,t,n,a,o){Backend.openModalSelector({id:"tl_listing",title:a.document.getElement("div.mce-title").get("text"),url:Contao.routes.backend_picker+"?context="+("file"==n?"link":"file")+"&amp;extras[fieldType]=radio&amp;extras[filesOnly]=true&amp;extras[source]="+o+"&amp;value="+t+"&amp;popup=1",callback:function(t,n){a.document.getElementById(e).value=n.join(",")}})},getScrollOffset:function(){window.sessionStorage.setItem("contao_backend_offset",window.getScroll().y)},initScrollOffset:function(){$$('.tl_submit_container button[name][name!="save"]').each((function(e){e.addEvent("click",(function(){window.sessionStorage.removeItem("contao_backend_offset")}))}));var e=window.sessionStorage.getItem("contao_backend_offset");if(window.sessionStorage.removeItem("contao_backend_offset"),e){var t=window.document.getElementById("header"),n=0;t&&t.addClass("down"),$$("[data-add-to-scroll-offset]").each((function(e){var t=e.get("data-add-to-scroll-offset"),a=e.getScrollSize().y,o=!1,l=!1;t?("-"===t.charAt(0)&&(o=!0,t=t.substring(1)),"%"===t.charAt(t.length-1)&&(l=!0,t=t.substring(0,t.length-1)),t=parseInt(t,10),l&&(t=Math.round(a*t/100)),o&&(t*=-1),n+=t):n+=a})),this.vScrollTo(parseInt(e,10)+n)}},autoSubmit:function(e){Backend.getScrollOffset();var t=new Element("input",{type:"hidden",name:"SUBMIT_TYPE",value:"auto"}),n=$(e)||e;t.inject(n,"bottom"),n.submit()},vScrollTo:function(e){window.addEvent("load",(function(){window.scrollTo(null,parseInt(e))}))},toggleCheckboxes:function(e,t){for(var n=$$("input"),a=$(e).checked?"checked":"",o=0;o<n.length;o++)"checkbox"==n[o].type.toLowerCase()&&(void 0!==t&&t!=n[o].id.substr(0,t.length)||(n[o].checked=a))},toggleCheckboxGroup:function(e,t){var n=$(e).className,a=$(e).checked?"checked":"";"tl_checkbox"==n?($(t)?$$("#"+t+" .tl_checkbox"):$(e).getParent("fieldset").getElements(".tl_checkbox")).each((function(e){e.checked=a})):"tl_tree_checkbox"==n&&$$("#"+t+" .parent .tl_tree_checkbox").each((function(e){e.checked=a}));Backend.getScrollOffset()},toggleCheckboxElements:function(e,t){var n=$(e).checked?"checked":"";$$("."+t).each((function(e){e.hasClass("tl_checkbox")&&(e.checked=n)})),Backend.getScrollOffset()},toggleWrap:function(e){var t=$(e),n="off"==t.getProperty("wrap")?"soft":"off";t.setProperty("wrap",n)},toggleUnchanged:function(){$$("#result-list .tl_confirm").each((function(e){e.toggleClass("hidden")}))},collapsePalettes:function(){$$("fieldset.hide").each((function(e){e.addClass("collapsed")})),$$("label.error, label.mandatory").each((function(e){var t=e.getParent("fieldset");t&&t.removeClass("collapsed")}))},makeParentViewSortable:function(e){var t=new Scroller(document.getElement("body"),{onChange:function(e,t){this.element.scrollTo(this.element.getScroll().x,t)}}),n=new Sortables(e,{constrain:!0,opacity:.6,onStart:function(){t.start()},onComplete:function(){t.stop()},onSort:function(e){var t,n,a=e.getParent("ul"),o=0;if(a&&(t=a.getChildren("li > div:first-child")))for(n=0;n<t.length;n++)t[n].hasClass("wrapper_stop")&&o>0&&o--,t[n].className=t[n].className.replace(/(^|\s)indent[^\s]*/g,""),o>0&&t[n].addClass("indent").addClass("indent_"+o),t[n].hasClass("wrapper_start")&&o++,t[n].removeClass("indent_first"),t[n].removeClass("indent_last"),t[n-1]&&t[n-1].hasClass("wrapper_start")&&t[n].addClass("indent_first"),t[n+1]&&t[n+1].hasClass("wrapper_stop")&&t[n].addClass("indent_last")},handle:".drag-handle"});n.active=!1,n.addEvent("start",(function(){n.active=!0})),n.addEvent("complete",(function(e){var t,a,o,l;n.active&&(e.getPrevious("li")?(t=e.get("id").replace(/li_/,""),a=e.getPrevious("li").get("id").replace(/li_/,""),o=window.location.search.replace(/id=[0-9]*/,"id="+t)+"&act=cut&mode=1&pid="+a,l=window.location.href.replace(/\?.*$/,""),new Request.Contao({url:l+o,followRedirects:!1}).get()):e.getParent("ul")&&(t=e.get("id").replace(/li_/,""),a=e.getParent("ul").get("id").replace(/ul_/,""),o=window.location.search.replace(/id=[0-9]*/,"id="+t)+"&act=cut&mode=2&pid="+a,l=window.location.href.replace(/\?.*$/,""),new Request.Contao({url:l+o,followRedirects:!1}).get()))}))},makeMultiSrcSortable:function(e,t,n){var a=new Sortables($(e),{constrain:!0,opacity:.6}).addEvent("complete",(function(){var n,a=[],o=$(e).getChildren("[data-id]");for(n=0;n<o.length;n++)a.push(o[n].get("data-id"));$(t).value=a.join(",")}));$(e).getElements(".gimage").each((function(e){e.hasClass("removable")?new Element("button",{type:"button",html:"&times;",class:"tl_red"}).addEvent("click",(function(){var a=e.getParent("li"),o=a.get("data-id");$(n).value=$(n).value.split(",").filter((function(e){return e!=o})).join(","),$(t).value=$(t).value.split(",").filter((function(e){return e!=o})).join(","),a.dispose()})).inject(e,"after"):new Element("button",{type:"button",html:"&times",disabled:!0}).inject(e,"after")})),a.fireEvent("complete")},enableFileTreeDragAndDrop:function(e,t){var n=new Scroller(document.getElement("body"),{onChange:function(e,t){this.element.scrollTo(this.element.getScroll().x,t)}});function a(e){return e&&e.hasClass("parent")&&e.getPrevious(".tl_folder")?e.getPrevious(".tl_folder"):e}e.addEvent("mousedown",(function(o){var l=o.target.hasClass("drag-handle")?o.target:o.target.getParent(".drag-handle"),i=o.target.getParent(".tl_file,.tl_folder");if(l&&i&&!o.rightClick){n.start(),e.addClass("tl_listing_dragging");var r,c,s=i.getElements(".tl_left")[0]||i,d=s.clone(!0).inject(e).addClass("tl_left_dragging");d.setPosition({x:o.page.x-s.getOffsetParent().getPosition().x-d.getSize().x,y:s.getPosition(s.getOffsetParent()).y}).setStyle("display","none");var u=new Drag.Move(d,{droppables:$$([e]).append(e.getElements(".tl_folder,li.parent,.tl_folder_top")),unDraggableTags:[],modifiers:{x:"left",y:"top"},onStart:function(){d.setStyle("display","")},onEnter:function(t,n){if((n=a(n)).addClass("tl_folder_dropping"),n.hasClass("tl_folder")&&r!==n){r=n,c=(new Date).getTime();var o=n.getElement('img[src$="/icons/folPlus.svg"]');(o=o&&o.getParent("a"))&&setTimeout((function(){if(r===n&&c+900<(new Date).getTime()){var t=document.createEvent("HTMLEvents");t.initEvent("click",!0,!0),o.dispatchEvent(t),r=void 0,c=void 0,window.addEvent("ajax_change",(function t(){u&&u.droppables&&e&&e.getElements&&(u.droppables=$$([e]).append(e.getElements(".tl_folder,li.parent"))),window.removeEvent("ajax_change",t)}))}}),1e3)}},onCancel:function(){r=void 0,c=void 0,n.stop(),d.destroy(),window.removeEvent("keyup",g),e.getElements(".tl_folder_dropping").removeClass("tl_folder_dropping"),e.removeClass("tl_listing_dragging")},onDrop:function(o,l){if(r=void 0,c=void 0,n.stop(),d.destroy(),window.removeEvent("keyup",g),e.getElements(".tl_folder_dropping").removeClass("tl_folder_dropping"),e.removeClass("tl_listing_dragging"),l=a(l)){var s=i.get("data-id"),u=l.get("data-id")||decodeURIComponent(t.url.split(/[?&]pid=/)[1].split("&")[0]);s&&u&&(0===(u+"/").indexOf(s+"/")||u+"/"===s.replace(/[^/]+$/,""))||(Backend.getScrollOffset(),document.location.href=t.url+"&id="+encodeURIComponent(s)+"&pid="+encodeURIComponent(u))}},onLeave:function(e,t){(t=a(t)).removeClass("tl_folder_dropping"),r=void 0,c=void 0}});u.start(o),window.addEvent("keyup",g)}function g(e){"esc"===e.key&&u&&u.stop&&(u.droppables=$$([]),u.stop())}}))},listWizard:function(e){var t=$(e),n=function(e){var a,o,l,i;e.getElements("button").each((function(r){if(!r.hasEvent("click"))switch(r.getProperty("data-command")){case"copy":r.addEvent("click",(function(){Backend.getScrollOffset(),a=e.clone(!0).inject(e,"before"),(o=e.getFirst("input"))&&(a.getFirst("input").value=o.value),n(a)}));break;case"delete":r.addEvent("click",(function(){Backend.getScrollOffset(),t.getChildren().length>1&&e.destroy()}));break;case null:r.addEvent("keydown",(function(n){38==n.event.keyCode?(n.preventDefault(),(l=e.getPrevious("li"))?e.inject(l,"before"):e.inject(t,"bottom"),r.focus()):40==n.event.keyCode&&(n.preventDefault(),(i=e.getNext("li"))?e.inject(i,"after"):e.inject(t.getFirst("li"),"before"),r.focus())}))}}))};!function(e){new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle"})}(t),t.getChildren().each((function(e){n(e)}))},tableWizard:function(e){var t=$(e),n=t.getElement("thead"),a=t.getElement("tbody"),o=function(e){var t,n,a,l,i=e.getChildren();for(a=0;a<i.length;a++)for(n=i[a].getChildren(),l=0;l<n.length;l++)(t=n[l].getFirst("textarea"))&&(t.name=t.name.replace(/\[[0-9]+][[0-9]+]/g,"["+a+"]["+l+"]"));new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){o(e)}})},l=function(e){var t,r,c,s,d,u,g,f=n.getFirst("tr");e.getElements("button").each((function(n){if(!n.hasEvent("click"))switch(n.getProperty("data-command")){case"rcopy":n.addEvent("click",(function(){for(Backend.getScrollOffset(),s=new Element("tr"),d=e.getChildren(),g=0;g<d.length;g++)c=d[g].clone(!0).inject(s,"bottom"),(t=d[g].getFirst("textarea"))&&(c.getFirst("textarea").value=t.value);s.inject(e,"after"),l(s),o(a)}));break;case"rdelete":n.addEvent("click",(function(){Backend.getScrollOffset(),a.getChildren().length>1&&e.destroy(),o(a)}));break;case"ccopy":n.addEvent("click",(function(){for(Backend.getScrollOffset(),u=i(n),d=a.getChildren(),g=0;g<d.length;g++)r=d[g].getChildren()[u],c=r.clone(!0).inject(r,"after"),(t=r.getFirst("textarea"))&&(c.getFirst("textarea").value=t.value),l(c);var e=f.getFirst("td");c=e.clone(!0).inject(f.getLast("td"),"before"),l(c),o(a)}));break;case"cmovel":n.addEvent("click",(function(){if(Backend.getScrollOffset(),u=i(n),d=a.getChildren(),u>0)for(g=0;g<d.length;g++)(r=d[g].getChildren()[u]).inject(r.getPrevious(),"before");else for(g=0;g<d.length;g++)(r=d[g].getChildren()[u]).inject(d[g].getLast(),"before");o(a)}));break;case"cmover":n.addEvent("click",(function(){if(Backend.getScrollOffset(),u=i(n),d=a.getChildren(),u<e.getChildren().length-2)for(g=0;g<d.length;g++)(r=d[g].getChildren()[u]).inject(r.getNext(),"after");else for(g=0;g<d.length;g++)(r=d[g].getChildren()[u]).inject(d[g].getFirst(),"before");o(a)}));break;case"cdelete":n.addEvent("click",(function(){if(Backend.getScrollOffset(),u=i(n),d=a.getChildren(),e.getChildren().length>2){for(g=0;g<d.length;g++)d[g].getChildren()[u].destroy();f.getFirst("td").destroy()}o(a)}));break;case null:n.addEvent("keydown",(function(t){38==t.event.keyCode?(t.preventDefault(),(s=e.getPrevious("tr"))?e.inject(s,"before"):e.inject(a,"bottom"),n.focus(),o(a)):40==t.event.keyCode&&(t.preventDefault(),(s=e.getNext("tr"))?e.inject(s,"after"):e.inject(a,"top"),n.focus(),o(a))}))}}))},i=function(e){var t,n=$(e).getParent("td"),a=n.getParent("tr").getChildren(),o=0;for(t=0;t<a.length&&a[t]!=n;t++)o++;return o};o(a),n.getChildren().each((function(e){l(e)})),a.getChildren().each((function(e){l(e)})),Backend.tableWizardResize()},tableWizardResize:function(e){var t=window.localStorage.getItem("contao_table_wizard_cell_size");if(void 0!==e)t="",$$(".tl_tablewizard textarea").each((function(n){n.setStyle("width",(n.getStyle("width").toInt()*e).round().limit(142,284)),n.setStyle("height",(n.getStyle("height").toInt()*e).round().limit(66,132)),""==t&&(t=n.getStyle("width")+"|"+n.getStyle("height"))})),window.localStorage.setItem("contao_table_wizard_cell_size",t);else if(null!==t){var n=t.split("|");$$(".tl_tablewizard textarea").each((function(e){e.setStyle("width",n[0]),e.setStyle("height",n[1])}))}},tableWizardSetWidth:function(){var e=$("tl_tablewizard");e&&e.setStyle("width",Math.round(.96*e.getParent(".tl_formbody_edit").getComputedSize().width))},moduleWizard:function(e){var t=$(e).getElement("tbody"),n=function(e){var t,a,o,l,i,r=e.getChildren();for(a=0;a<r.length;a++)for(t=r[a].getChildren(),o=0;o<t.length;o++)(l=t[o].getElement("select"))&&(l.name=l.name.replace(/\[[0-9]+]/g,"["+a+"]")),(i=t[o].getElement('input[type="checkbox"]'))&&(i.set("tabindex",-1),i.name=i.name.replace(/\[[0-9]+]/g,"["+a+"]"));new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){n(e)}})},a=function(e){var o,l,i,r,c,s;e.getElements("button").each((function(d){if(!d.hasEvent("click"))switch(d.getProperty("data-command")){case"copy":d.addEvent("click",(function(){for(Backend.getScrollOffset(),i=new Element("tr"),r=e.getChildren(),s=0;s<r.length;s++)l=r[s].clone(!0).inject(i,"bottom"),(o=r[s].getElement("select"))&&(l.getElement("select").value=o.value);i.inject(e,"after"),i.getElement(".chzn-container").destroy(),new Chosen(i.getElement("select.tl_select")),a(i),n(t)}));break;case"delete":d.addEvent("click",(function(){Backend.getScrollOffset(),t.getChildren().length>1&&e.destroy(),n(t)}));break;case"enable":d.addEvent("click",(function(){Backend.getScrollOffset(),(c=d.getNext('input[type="checkbox"]')).checked?(c.checked="",d.getElement("img").src=Backend.themePath+"icons/invisible.svg"):(c.checked="checked",d.getElement("img").src=Backend.themePath+"icons/visible.svg"),n(t)}));break;case null:d.addEvent("keydown",(function(a){38==a.event.keyCode?(a.preventDefault(),(i=e.getPrevious("tr"))?e.inject(i,"before"):e.inject(t,"bottom"),d.focus(),n(t)):40==a.event.keyCode&&(a.preventDefault(),(i=e.getNext("tr"))?e.inject(i,"after"):e.inject(t,"top"),d.focus(),n(t))}))}}))};n(t),t.getChildren().each((function(e){a(e)}))},optionsWizard:function(e){var t=$(e).getElement("tbody"),n=function(e){var t,a,o,l,i=e.getChildren();for(a=0;a<i.length;a++)for(t=i[a].getChildren(),o=0;o<t.length;o++)(l=t[o].getFirst("input"))&&(l.name=l.name.replace(/\[[0-9]+]/g,"["+a+"]"),"checkbox"==l.type&&(l.id=l.name.replace(/\[[0-9]+]/g,"").replace(/\[/g,"_").replace(/]/g,"")+"_"+a,l.getNext("label").set("for",l.id)));new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){n(e)}})},a=function(e){var o,l,i,r,c;e.getElements("button").each((function(s){if(!s.hasEvent("click"))switch(s.getProperty("data-command")){case"copy":s.addEvent("click",(function(){for(Backend.getScrollOffset(),i=new Element("tr"),r=e.getChildren(),c=0;c<r.length;c++)l=r[c].clone(!0).inject(i,"bottom"),(o=r[c].getFirst("input"))&&(l.getFirst("input").value=o.value,"checkbox"==o.type&&(l.getFirst("input").checked=o.checked?"checked":""));i.inject(e,"after"),a(i),n(t)}));break;case"delete":s.addEvent("click",(function(){Backend.getScrollOffset(),t.getChildren().length>1&&e.destroy(),n(t)}));break;case null:s.addEvent("keydown",(function(a){38==a.event.keyCode?(a.preventDefault(),(i=e.getPrevious("tr"))?e.inject(i,"before"):e.inject(t,"bottom"),s.focus(),n(t)):40==a.event.keyCode&&(a.preventDefault(),(i=e.getNext("tr"))?e.inject(i,"after"):e.inject(t,"top"),s.focus(),n(t))}))}}))};n(t),t.getChildren().each((function(e){a(e)}))},keyValueWizard:function(e){var t=$(e).getElement("tbody"),n=function(e){var t,a,o,l,i=e.getChildren();for(a=0;a<i.length;a++)for(t=i[a].getChildren(),o=0;o<t.length;o++)(l=t[o].getFirst("input"))&&(l.name=l.name.replace(/\[[0-9]+]/g,"["+a+"]"));new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){n(e)}})},a=function(e){var o,l,i,r,c;e.getElements("button").each((function(s){if(!s.hasEvent("click"))switch(s.getProperty("data-command")){case"copy":s.addEvent("click",(function(){for(Backend.getScrollOffset(),i=new Element("tr"),r=e.getChildren(),c=0;c<r.length;c++)l=r[c].clone(!0).inject(i,"bottom"),(o=r[c].getFirst("input"))&&(l.getFirst().value=o.value);i.inject(e,"after"),a(i),n(t)}));break;case"delete":s.addEvent("click",(function(){Backend.getScrollOffset(),t.getChildren().length>1&&e.destroy(),n(t)}));break;case null:s.addEvent("keydown",(function(a){38==a.event.keyCode?(a.preventDefault(),(i=e.getPrevious("tr"))?e.inject(i,"before"):e.inject(t,"bottom"),s.focus(),n(t)):40==a.event.keyCode&&(a.preventDefault(),(i=e.getNext("tr"))?e.inject(i,"after"):e.inject(t,"top"),s.focus(),n(t))}))}}))};n(t),t.getChildren().each((function(e){a(e)}))},checkboxWizard:function(e){var t=$(e).getElement(".sortable");!function(e){new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle"})}(t),t.getChildren().each((function(e){!function(e){var n;e.getElements("button").each((function(a){a.hasEvent("click")||a.addEvent("keydown",(function(o){38==o.event.keyCode?(o.preventDefault(),(n=e.getPrevious("span"))?e.inject(n,"before"):e.inject(t,"bottom"),a.focus()):40==o.event.keyCode&&(o.preventDefault(),(n=e.getNext("span"))?e.inject(n,"after"):e.inject(t,"top"),a.focus())}))}))}(e)}))},toggleAddLanguageButton:function(e){var t=e.getParent("div").getElement('input[type="button"]');""!=e.value?t.removeProperty("disabled"):t.setProperty("disabled",!0)},sectionWizard:function(e){var t=$(e).getElement("tbody"),n=function(e){var t,a,o,l=e.getChildren();for(a=0;a<l.length;a++)for(t=l[a].getChildren(),o=0;o<t.length;o++)t[o].getElements("input").each((function(e){e.name=e.name.replace(/\[[0-9]+]/g,"["+a+"]")})),t[o].getElements("select").each((function(e){e.name=e.name.replace(/\[[0-9]+]/g,"["+a+"]")}));new Sortables(e,{constrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){n(e)}})},a=function(e){var o,l,i,r,c,s,d;e.getElements("button").each((function(u){if(!u.hasEvent("click"))switch(u.getProperty("data-command")){case"copy":u.addEvent("click",(function(){for(Backend.getScrollOffset(),l=new Element("tr"),i=e.getChildren(),s=0;s<i.length;s++)for(o=i[s].clone(!0).inject(l,"bottom"),r=i[s].getElements("select"),c=o.getElements("select"),d=0;d<r.length;d++)c[d].value=r[d].value;l.inject(e,"after"),a(l),n(t)}));break;case"delete":u.addEvent("click",(function(){Backend.getScrollOffset(),t.getChildren().length>1&&e.destroy(),n(t)}));break;case null:u.addEvent("keydown",(function(a){38==a.event.keyCode?(a.preventDefault(),(l=e.getPrevious("tr"))?e.inject(l,"before"):e.inject(t,"bottom"),u.focus(),n(t)):40==a.event.keyCode&&(a.preventDefault(),(l=e.getNext("tr"))?e.inject(l,"after"):e.inject(t,"top"),u.focus(),n(t))}))}}))};n(t),t.getChildren().each((function(e){a(e)}))},updateModuleLink:function(e){var t=e.getParent("tr").getLast("td"),n=t.getElement("a.module_link");n.href=n.href.replace(/id=[0-9]+/,"id="+e.value),e.value>0?(t.getElement("a.module_link").setStyle("display",null),t.getElement("img.module_image").setStyle("display","none")):(t.getElement("a.module_link").setStyle("display","none"),t.getElement("img.module_image").setStyle("display",null))},enableImageSizeWidgets:function(){$$(".tl_image_size").each((function(e){var t=e.getElement("select"),n=e.getChildren("input")[0],a=e.getChildren("input")[1],o=function(){if(""===t.get("value")||0===t.get("value").indexOf("_")||t.get("value").toInt().toString()===t.get("value")){n.readOnly=!0,a.readOnly=!0;var e=$(t.getSelected()[0]).get("text");e=e.split("(").length>1?e.split("(").getLast().split(")")[0].split("x"):["",""],n.set("value","").set("placeholder",1*e[0]||""),a.set("value","").set("placeholder",1*e[1]||"")}else n.set("placeholder",""),a.set("placeholder",""),n.readOnly=!1,a.readOnly=!1};o(),t.addEvent("change",o),t.addEvent("keyup",o)}))},enableToggleSelect:function(){var e,t,n,a,o,l,i=$("tl_listing"),r=function(i){for(t=s.indexOf(i),n=s.indexOf(e),o=Math.min(t,n),l=Math.max(t,n),a=!!s[n].checked;o<=l;o++)s[o].checked=a},c=function(t){var n=this.getElement('input[type="checkbox"],input[type="radio"]'),a=$(t.target).getParent(".limit_toggler");n&&!n.get("disabled")&&null===a&&("radio"!=n.type?(t.shift&&e?r(n):(n.checked=n.checked?"":"checked","Backend.toggleCheckboxes(this)"==n.get("onclick")&&Backend.toggleCheckboxes(n)),e=n):n.checked||(n.checked="checked"))},s=[];i&&(s=i.getElements('input[type="checkbox"]')),$$(".toggle_select").each((function(e){var t=e.retrieve("boundEvent");t&&e.removeEvent("click",t),e.getElements('label,input[type="checkbox"],input[type="radio"]').each((function(e){e.addEvent("click",(function(e){e.stopPropagation()}))})),t=c.bind(e),e.addEvent("click",t),e.store("boundEvent",t)})),s.each((function(t){t.addEvent("click",(function(t){t.shift&&e&&r(this),e=this}))}))},autoFocusFirstInputField:function(){var e=document.id("main").getElement(".tl_formbody_edit");if(e){var t=e.getElements("input, textarea").filter((function(e){return!e.get("disabled")&&!e.get("readonly")&&e.isVisible()&&"checkbox"!==e.get("type")&&"radio"!==e.get("type")&&"submit"!==e.get("type")&&"image"!==e.get("type")&&(!e.get("autocomplete")||"off"===e.get("autocomplete")||!e.get("value"))}));t[0]&&t[0].focus()}},editPreviewWizard:function(e){var t,n,a=(e=$(e)).getElement("img"),o={},l=!1,i=function(){return{x:a.getComputedSize().width,y:a.getComputedSize().height}},r=function(){var e=i(),n=a.getComputedSize();t.setStyles({top:n.computedTop+(o.y.get("value")*e.y).round()+"px",left:n.computedLeft+(o.x.get("value")*e.x).round()+"px",width:(o.width.get("value")*e.x).round()+"px",height:(o.height.get("value")*e.y).round()+"px"}),o.width.get("value").toFloat()&&o.height.get("value").toFloat()?t.setStyle("display",null):t.setStyle("display","none")},c=function(t){t.preventDefault(),l||(l=!0,n={x:t.page.x-e.getPosition().x-a.getComputedSize().computedLeft,y:t.page.y-e.getPosition().y-a.getComputedSize().computedTop},s(t))},s=function(r){if(l){r.preventDefault();var c=a.getComputedSize(),s={x:[Math.max(0,Math.min(c.width,n.x)),Math.max(0,Math.min(c.width,r.page.x-e.getPosition().x-c.computedLeft))],y:[Math.max(0,Math.min(c.height,n.y)),Math.max(0,Math.min(c.height,r.page.y-e.getPosition().y-c.computedTop))]};t.setStyles({top:Math.min(s.y[0],s.y[1])+c.computedTop+"px",left:Math.min(s.x[0],s.x[1])+c.computedLeft+"px",width:Math.abs(s.x[0]-s.x[1])+"px",height:Math.abs(s.y[0]-s.y[1])+"px"}),function(){var e=i(),n=t.getStyles("top","left","width","height"),l=a.getComputedSize(),r={x:Math.max(0,Math.min(1,(n.left.toFloat()-l.computedLeft)/e.x)),y:Math.max(0,Math.min(1,(n.top.toFloat()-l.computedTop)/e.y))};r.width=Math.min(1-r.x,n.width.toFloat()/e.x),r.height=Math.min(1-r.y,n.height.toFloat()/e.y),r.width&&r.height?t.setStyle("display",null):(r.x=r.y=r.width=r.height="",t.setStyle("display","none")),Object.each(r,(function(e,t){o[t].set("value",e)}))}()}},d=function(e){s(e),l=!1};window.addEvent("domready",(function(){e.getParent(".tl_tbox,.tl_box").getElements('input[name^="importantPart"]').each((function(e){["x","y","width","height"].each((function(t){e.get("name").substr(13,t.length)===t.capitalize()&&(o[t]=e=$(e))}))})),4===Object.getLength(o)&&(Object.each(o,(function(e){e.getParent().setStyle("display","none")})),e.addClass("tl_edit_preview_enabled"),t=new Element("div",{class:"tl_edit_preview_important_part"}).inject(e),r(),a.addEvent("load",r),e.addEvents({mousedown:c,touchstart:c}),$(document.documentElement).addEvents({mousemove:s,touchmove:s,mouseup:d,touchend:d,touchcancel:d,resize:r}))}))},enableFileTreeUpload:function(e,t){e=$(e);var n,a,o=t.url,l=new Element("div",{class:"dropzone dropzone-filetree",html:'<span class="dropzone-previews"></span>'}).inject(e,"top");t.previewsContainer=l.getElement(".dropzone-previews"),t.clickable=!1;var i=new Dropzone(e,t);i.on("queuecomplete",(function(){window.location.reload()})),i.on("dragover",(function(t){if(t.dataTransfer&&t.dataTransfer.types&&-1!==t.dataTransfer.types.indexOf("Files")){e.getElements(".tl_folder_dropping").removeClass("tl_folder_dropping");var l=t.target&&$(t.target);if(l){var r=l.match(".tl_folder")?l:l.getParent(".tl_folder");if(r||(r=(r=l.getParent(".parent"))&&r.getPrevious(".tl_folder")),r){var c=r.getElement('img[src$="/icons/new.svg"]');c=c&&c.getParent("a")}}if(c&&c.href){if(i.options.url=""+c.href,r.addClass("tl_folder_dropping"),n!==r){n=r,a=(new Date).getTime();var s=r.getElement('img[src$="/icons/folPlus.svg"]');(s=s&&s.getParent("a"))&&setTimeout((function(){if(n===r&&a+900<(new Date).getTime()){var e=document.createEvent("HTMLEvents");e.initEvent("click",!0,!0),s.dispatchEvent(e),n=void 0,a=void 0}}),1e3)}}else i.options.url=o,n=void 0,a=void 0}})),i.on("drop",(function(e){e.dataTransfer&&e.dataTransfer.types&&-1!==e.dataTransfer.types.indexOf("Files")&&(l.addClass("dropzone-filetree-enabled"),Backend.getScrollOffset())})),i.on("dragleave",(function(){e.getElements(".tl_folder_dropping").removeClass("tl_folder_dropping"),n=void 0,a=void 0}))},crawl:function(){var e=$("tl_crawl"),t=e.getElement("div.progress-bar"),n=e.getElement("p.progress-count"),a=e.getElement("div.results");!function e(o){o=o||!1,new Request({url:window.location.href,headers:{"Only-Status-Update":o},onSuccess:function(o){var l=JSON.decode(o);!function(e){var o,l=e.total-e.pending,i=e.total>0?parseInt(l/e.total*100,10):100;if(t.setStyle("width",i+"%"),t.set("html",i+"%"),t.setAttribute("aria-valuenow",i),n.set("html",l+" / "+e.total),e.finished)for(o in t.removeClass("running").addClass("finished"),a.removeClass("running").addClass("finished"),e.results)if(e.results.hasOwnProperty(o)){var r=a.getElement('.result[data-subscriber="'+o+'"] p.summary'),c=a.getElement('.result[data-subscriber="'+o+'"] p.warning'),s=a.getElement('.result[data-subscriber="'+o+'"] p.subscriber-log'),d=e.results[o],u=d.summary;d.warning&&c.set("html",d.warning),d.hasLog&&s.setStyle("display","block"),r.addClass(d.wasSuccessful?"success":"failure"),r.set("html",u)}}(l),l.finished||setTimeout(e,2e3)}}).send()}(!0)}};window.addEvent("domready",(function(){$(document.body).addClass("js"),Browser.Features.Touch&&$(document.body).addClass("touch"),Backend.collapsePalettes(),Backend.tableWizardSetWidth(),Backend.enableImageSizeWidgets(),Backend.enableToggleSelect(),Backend.autoFocusFirstInputField(),null!=Elements.chosen&&$$("select.tl_chosen").chosen(),$$("textarea.monospace").each((function(e){Backend.toggleWrap(e)}))})),window.addEvent("resize",(function(){Backend.tableWizardSetWidth()})),window.addEvent("ajax_change",(function(){Backend.enableImageSizeWidgets(),Backend.enableToggleSelect(),null!=Elements.chosen&&$$("select.tl_chosen").filter((function(e){return"none"!=e.getStyle("display")})).chosen()}));